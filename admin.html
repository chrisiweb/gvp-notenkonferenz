<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GvP Notenkonferenz Liveticker</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
/* ============================================================
   BASIS-STYLES (aus deiner letzten Version)
   ============================================================ */
:root {
  --bg: #0b1020;
  --fg: #eaf2ff;
  --c-aktuell: #0ea5e9;
  --c-vorb: #22c55e;
  --card-bg: #151a31;
  --card-bd: #2a335f;
}
body {
  font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
  margin:0;
  padding:20px;
  background:var(--bg);
  color:var(--fg);
}
.box {
  background: var(--card-bg);
  padding:20px;
  border-radius:12px;
  max-width:900px;
  margin:auto;
  border:1px solid var(--card-bd);
}
input {
  width:100%;
  padding:10px;
  border-radius:8px;
  background:#0f1428;
  color:#eaf2ff;
  border:1px solid var(--card-bd);
}
button {
  padding:10px 16px;
  border:0;
  border-radius:8px;
  cursor:pointer;
  font-size:16px;
}
.big-button {
  padding: 20px 32px !important;
  font-size: 24px !important;
  min-width: 140px;
  min-height: 110px;
  display: flex;
  justify-content: center;
  align-items: center;
}
.btn-primary { background:#3b82f6; color:white; }
.btn-red { background:#ef4444; color:white; }
.row-space { display:flex; gap:8px; align-items:center; justify-content:space-between; margin-top:10px; }
.row-left  { display:flex; gap:8px; align-items:center; }
.label { font-weight:600; margin-top:12px; display:block; }
.muted { opacity:.75; font-size:13px; }
.error { color:#ffb4b4; margin-top:8px; }
.saving { opacity:.7; font-size:12px; }

/* ============================================================
   VORSCHAU-KARTEN
   ============================================================ */
.cards{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
  margin-top:14px;
}
.card {
  background: linear-gradient(135deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  border:1px solid var(--card-bd);
  border-radius:14px;
  padding:16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
}
.card.aktuell{ border-color: color-mix(in lab, var(--c-aktuell) 60%, transparent); }
.card.vorb   { border-color: color-mix(in lab, var(--c-vorb)    60%, transparent); }
.card .title { opacity:.9; font-weight:700; letter-spacing:.06em; text-transform: uppercase; font-size:14px; }
.card .value { margin-top:.25em; font-weight:800; line-height:1.1; font-size: clamp(28px, 5vw, 64px); word-wrap:break-word; }

/* Raumzeile in Vorschau */
.card .room {
  margin-top:.35em;
  font-size: clamp(14px, 3vw, 24px);
  opacity:.85;
  font-weight:600;
}

@media (max-width: 740px){
  .cards{ grid-template-columns:1fr; }
}

/* ============================================================
   KLASSENLISTE
   ============================================================ */
.listView {
  margin-top: 10px;
  border: 1px solid var(--card-bd);
  border-radius: 8px;
  background: #0f1428;
  max-height: 300px;
  overflow-y: auto;
  padding: 4px 0;
  font-size: 15px;
}
.listItem {
  padding: 6px 12px;
  cursor: pointer;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  display:flex;
  gap:8px;
  align-items:center;
  scroll-margin: 10px;
}
.listItem:hover { background: rgba(255,255,255,0.05); }
.listItem.active{
  background: rgba(14,165,233,0.20);
  border-left: 4px solid var(--c-aktuell);
  padding-left: 8px;
}
.listItem.next{
  background: rgba(34,197,94,0.16);
  border-left: 4px solid var(--c-vorb);
  padding-left: 8px;
}
.pill {
  display:inline-block; font-size:11px;
  padding:2px 6px; border-radius:999px;
  background: rgba(255,255,255,0.10);
  opacity:.9;
}
.pill.vorb{ background: rgba(34,197,94,0.22); }
.listEmpty { padding:8px 12px; opacity:.7; font-style:italic; }

/* ============================================================
   MODAL (überarbeitet)
   ============================================================ */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  padding:20px;
  z-index:1000;
}
.modal.open { display:flex; }

/* Hintergrundscroll sperren */
body.modal-open {
  overflow:hidden;
  touch-action:none;
  overscroll-behavior:contain;
}

.modal-content {
  background: var(--card-bg);
  border:1px solid var(--card-bd);
  border-radius:12px;
  width: min(800px, 92vw);
  max-height: 90vh;
  overflow:auto;
  padding:16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.4);
  display:flex;
  flex-direction:column;
}
.modal-content h3 {
  margin:0 0 10px;
}

/* MODAL-INHALT FLEX */
.modal-body {
  flex:1 1 auto;
  min-height:0;
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow:hidden;
}

.textarea-wrap {
  flex:1 1 auto;
  min-height:0;
  display:flex;
}
.textarea-wrap textarea {
  flex:1 1 auto;
  min-height:0;
  height:auto;
  max-height:100%;
  overflow:auto;
  resize:vertical;
  padding:10px;
  border-radius:8px;
  border:1px solid var(--card-bd);
  background:#0f1428; color:#eaf2ff;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}

/* Hinweis direkt UNTER Textarea */
.unter-hinweis {
  font-size: 14px;
  opacity:.75;
  margin-top:4px;
}

/* Buttons */
.modal-actions {
  margin-top:12px;
}
.buttons-wrap {
  display:flex;
  gap:10px;
  align-items:center;
}

/* Räume */
.grid-two {
  display:grid;
  grid-template-columns: minmax(0,1fr) minmax(0,1fr);
  gap:8px;
}
#raum1Input,#raum2Input {
  padding:8px;
  font-size:14px;
}

/* ============================================================
   LOGOUT BUTTON
   ============================================================ */
.logout-btn {
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 1500;
  background: #0f172a;
  color: #eaf2ff;
  border: 1px solid #334155;
  border-radius: 999px;
  padding: 10px 14px;
  font-size: 14px;
  display: none;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
  cursor:pointer;
}
.logout-btn:hover { background:#111827; }
.logout-btn:active { transform:translateY(1px); }

/* ============================================================
   RESPONSIVE (Mobile)
   ============================================================ */
@media (max-width:860px){
  .box{ padding:14px; }
  .row-space { gap:10px; }
  .big-button{
    min-height:72px;
    font-size:20px!important;
  }
  .card .value{ font-size:clamp(24px,6vw,48px); }
  .card .room { font-size:clamp(13px,2.8vw,18px); }
}

@media (max-width:640px){

  .row-space{
    flex-direction: column;
    align-items: stretch;
  }
  .box{ padding:12px; }

  /* Buttons full width */
  .row-left{
    width:100%;
    gap:8px;
  }
  .row-left > button{
    flex:1 1 auto;
    width:100%;
    justify-content:center;
  }

  .big-button{
    width:100%;
    min-height:64px;
    font-size:18px!important;
    padding:14px 16px!important;
  }

  #info{ font-size:12.5px; }

  /* Logout rein in die Box */
  .logout-btn{
    position:static;
    width:100%;
    margin-top:10px;
    justify-content:center;
  }

  /* Vollbild Modal */
  .modal{
    padding:0;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .modal-content{
    width:100vw;
    height:100dvh;
    max-height:100dvh;
    border-radius:0;
    overflow:hidden;
    padding:calc(12px + env(safe-area-inset-top)) 12px calc(12px + env(safe-area-inset-bottom));
    box-sizing:border-box;
  }
  .modal-content h3{
    font-size:18px;
    margin:0 0 8px;
  }

  /* Modal body flex scroll */
  .modal-body{
    flex:1 1 auto;
    min-height:0;
    overflow:hidden;
    gap:10px;
  }
  .textarea-wrap textarea{
    max-height:calc(100dvh - 260px);
  }

  /* Buttons untereinander */
  .buttons-wrap{
    flex-direction:column;
    width:100%;
  }
  .buttons-wrap>button{
    width:100%;
    justify-content:center;
    padding:12px 14px;
  }
}

@media (max-width:380px){
  .card .value{ font-size:clamp(22px,7vw,40px); }
  .card .room { font-size:clamp(12px,3.2vw,16px); }
  .btn-primary,.btn-red,.btn-ghost{ font-size:15px; }
}

  </style>
</head>
<body>

<!-- ============================================================
     LOGIN
============================================================ -->
<div class="box">
  <h2>GvP Notenkonferenz Liveticker</h2>

  <div id="loginBox">
    <label class="label">Benutzername</label>
    <input id="email" type="text" autocomplete="username" />
    <label class="label">Passwort</label>
    <input id="passwort" type="password" autocomplete="current-password" />
    <div class="row-left">
      <button id="loginBtn" class="btn-primary">Anmelden</button>
    </div>
    <div id="loginError" class="error"></div>
    <div class="muted" style="margin-top:6px;">
      Für GitHub Pages muss die Domain <code>chrisiweb.github.io</code> in Firebase unter
      <i>Authentifizierung → Einstellungen → Autorisierte Domains</i> freigegeben sein.
    </div>
  </div>

<!-- ============================================================
     PANEL
============================================================ -->
  <div id="panel" style="display:none;">

    <!-- Vorschau -->
    <div class="cards">
      <div class="card aktuell">
        <div class="title">Aktuell</div>
        <div id="cardAktuell" class="value">–</div>
        <div id="cardAktuellRoom" class="room"></div>
      </div>
      <div class="card vorb">
        <div class="title">In Vorbereitung</div>
        <div id="cardVorb" class="value">–</div>
        <div id="cardVorbRoom" class="room"></div>
      </div>
    </div>

    <!-- oben -->
    <div class="row-space" style="margin-top:12px;">
      <div class="row-left">
        <button id="startNextBtn" class="btn-primary big-button">
          Konferenz starten
        </button>
      </div>
    </div>

    <!-- klickbare Liste -->
    <div id="klassenList" class="listView"></div>

    <div class="muted">Klicke auf eine Klasse, um direkt zu dieser Klasse zu wechseln.</div>

    <div class="row-space">
      <div class="row-left">
        <button id="editBtn" class="btn-ghost">Klassen/Räume bearbeiten</button>
        <span id="saveHint" class="saving" aria-live="polite"></span>
      </div>
      <div class="row-left">
        <button id="prevBtn" class="btn-red">Eine Klasse zurückspringen</button>
        <button id="resetBtn" class="btn-red" style="background:#b91c1c;">Reset</button>
      </div>
    </div>

    <div id="info" class="muted" style="margin-top:10px;"></div>

  </div><!-- panel -->

</div><!-- box -->


<!-- ============================================================
     MODAL
============================================================ -->
<div id="listModal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-content">
    <h3 id="modalTitle">Klassenliste bearbeiten</h3>

    <div class="modal-body">

      <div class="grid-two">
        <div>
          <label class="label" for="raum1Input">1. Konferenzraum</label>
          <input id="raum1Input" type="text" placeholder="z. B. 8AT" />
        </div>
        <div>
          <label class="label" for="raum2Input">2. Konferenzraum</label>
          <input id="raum2Input" type="text" placeholder="z. B. 8S" />
        </div>
      </div>

      <div class="textarea-wrap">
        <textarea id="editorTextarea"></textarea>
      </div>

      <!-- Hinweis direkt unter der Liste -->
      <div class="muted unter-hinweis">
        Tipp: Eine Klasse pro Zeile. Leere Zeilen werden ignoriert.
      </div>

    </div><!-- modal-body -->

    <!-- Buttons unten -->
    <div class="modal-actions">
      <div class="buttons-wrap row-left">
        <button id="reverseBtn" class="btn-ghost" style="border-color:#3b82f6;color:#3b82f6;">Reihenfolge umdrehen</button>
        <button id="cancelEditBtn" class="btn-ghost">Abbrechen</button>
        <button id="saveEditBtn" class="btn-primary">Speichern</button>
      </div>
    </div>

  </div>
</div>


<!-- ============================================================
     LOGOUT
============================================================ -->
<button id="logoutBtn" class="logout-btn">Abmelden</button>


<!-- ============================================================
     SCRIPT
============================================================ -->
<script type="module">

/* == Firebase == */
const firebaseConfig = {
  apiKey: "AIzaSyCuLVnVCnpc1JPO5eRsUpwOdTjacZ6cgso",
  authDomain: "gvp-notenkonferenz.firebaseapp.com",
  databaseURL: "https://gvp-notenkonferenz-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "gvp-notenkonferenz",
  storageBucket: "gvp-notenkonferenz.appspot.com",
  messagingSenderId: "443453428623",
  appId: "1:443453428623:web:3d3640bfe6ed2c38e871fa",
  measurementId: "G-SVZX9DEJNP"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* == DOM == */
const loginBox = document.getElementById("loginBox");
const panel = document.getElementById("panel");
const info = document.getElementById("info");
const startNextBtn = document.getElementById("startNextBtn");
const prevBtn = document.getElementById("prevBtn");
const resetBtn = document.getElementById("resetBtn");
const klassenList = document.getElementById("klassenList");
const saveHint = document.getElementById("saveHint");
const cardAktuell = document.getElementById("cardAktuell");
const cardVorb = document.getElementById("cardVorb");
const cardAktuellRoom = document.getElementById("cardAktuellRoom");
const cardVorbRoom = document.getElementById("cardVorbRoom");
const loginError = document.getElementById("loginError");
const editBtn = document.getElementById("editBtn");
const logoutBtn = document.getElementById("logoutBtn");
const listModal = document.getElementById("listModal");
const editorTextarea = document.getElementById("editorTextarea");
const saveEditBtn = document.getElementById("saveEditBtn");
const cancelEditBtn = document.getElementById("cancelEditBtn");
const raum1Input = document.getElementById("raum1Input");
const raum2Input = document.getElementById("raum2Input");

/* == Zustand == */
let klassen = [];
let pos = 0;
let initialized = false;
let raum1 = "8AT";
let raum2 = "8S";

/* == Alias Login == */
const USERNAME_ALIASES = { "gvp": "admin@gvp-notenkonferenz.local" };
function mapToEmail(input){
  const raw=(input??"").trim();
  return USERNAME_ALIASES[raw.toLowerCase()] ?? raw;
}

/* == Login == */
document.getElementById("loginBtn").onclick = async ()=>{
  const emailOrUser=(document.getElementById("email").value??"").trim();
  const pass=(document.getElementById("passwort").value??"").trim();
  loginError.textContent="";
  try{
    await signInWithEmailAndPassword(auth,mapToEmail(emailOrUser),pass);
  }catch(err){
    loginError.textContent = "Benutzername/E‑Mail oder Passwort falsch.";
  }
};

onAuthStateChanged(auth, async(user)=>{
  const signedIn = !!user;
  loginBox.style.display = signedIn?"none":"";
  panel.style.display = signedIn?"":"none";
  logoutBtn.style.display = signedIn?"inline-flex":"none";

  if(!signedIn) return;

  await ladeSteuerung();
  editorTextarea.value = klassen.join("\n");
  raum1Input.value = raum1;
  raum2Input.value = raum2;

  aktualisiereKarten();
  aktualisiereStartNextLabel();
  zeigeInfo();
  aktualisiereKlassenListe();

  requestAnimationFrame(keepActiveAndNextInView);

  if(initialized) await schreibeAnzeige();
});

/* == Logout == */
logoutBtn.onclick = async ()=>{
  if(!confirm("Möchtest du dich wirklich abmelden?")) return;
  try{ await signOut(auth); }
  catch(e){ alert("Abmelden fehlgeschlagen."); }
};

/* == Laden / Speichern == */
async function ladeSteuerung(){
  const snap=await get(ref(db,"steuerung"));
  const v=snap.exists()?snap.val():{};
  klassen=Array.isArray(v.liste)?v.liste:[];
  pos=Number.isInteger(v.pos)?v.pos:0;
  initialized=typeof v.initialized==="boolean"?v.initialized:false;
  raum1=(typeof v.raum1==="string"&&v.raum1.trim())?v.raum1:"8AT";
  raum2=(typeof v.raum2==="string"&&v.raum2.trim())?v.raum2:"8S";
  if(pos<0) pos=0;
  if(pos>=klassen.length) pos=Math.max(klassen.length-1,0);
}

async function speichereSteuerung(){
  await set(ref(db,"steuerung"),{liste:klassen,pos,initialized,raum1,raum2});
}

async function schreibeAnzeige(){
  const aktuell=(klassen[pos]??"").trim()||null;
  const vorb=(klassen[pos+1]??"").trim()||null;
  const aktuellRaum = aktuell ? ((pos%2===0)?raum1:raum2) : null;
  const vorbRaum = vorb ? (((pos+1)%2===0)?raum1:raum2) : null;
  const now=Date.now();
  await update(ref(db,"anzeige"),{
    aktuell,
    vorbereitung:vorb,
    aktuellRaum,
    vorbereitungRaum:vorbRaum,
    aktualisiertAm:now,
    updatedAt:now
  });
}

/* == UI == */
function zeigeInfo(){
  const a=initialized?(klassen[pos]??"—"):"—";
  const v=initialized?(klassen[pos+1]??"—"):"—";
  info.innerHTML=
    `<div>Aktuell: <b>${a}</b></div>
     <div>In Vorbereitung: <b>${v}</b></div>
     <div>Position: ${klassen.length?(pos+1):0} / ${klassen.length} ${initialized?"":"(noch nicht gestartet)"} </div>`;
}

function aktualisiereKarten(){
  const a=initialized?(klassen[pos]??"—"):"—";
  const v=initialized?(klassen[pos+1]??"—"):"—";
  cardAktuell.textContent=a;
  cardVorb.textContent=v;
  const aR = initialized && a ? ((pos%2===0)?raum1:raum2):"";
  const vR = initialized && v ? (((pos+1)%2===0)?raum1:raum2):"";
  cardAktuellRoom.textContent = aR?`(Raum: ${aR})`:"";
  cardVorbRoom.textContent = vR?`(Raum: ${vR})`:"";
}

function aktualisiereStartNextLabel(){
  startNextBtn.textContent = initialized?"Nächste Klasse":"Konferenz starten";
}

/* == Liste == */
function aktualisiereKlassenListe(){
  klassenList.innerHTML="";
  if(!klassen.length){
    const d=document.createElement("div");
    d.className="listEmpty";
    d.textContent="Noch keine Klassen eingetragen.";
    klassenList.appendChild(d);
    return;
  }
  klassen.forEach((k,i)=>{
    const div=document.createElement("div");
    div.className="listItem";
    if(initialized && i===pos) div.classList.add("active");
    else if(initialized && i===pos+1) div.classList.add("next");
    div.dataset.index=i;

    const lbl=document.createElement("div");
    lbl.textContent=k;
    lbl.style.flex="1 1 auto";

    const pill=document.createElement("span");
    pill.className="pill";
    if(initialized && i===pos) pill.textContent="Aktuell";
    else if(initialized && i===pos+1){
      pill.textContent="Vorbereitung";
      pill.classList.add("vorb");
    } else pill.style.opacity="0";

    div.appendChild(lbl);
    div.appendChild(pill);

    div.onclick = async ()=>{
      if(i===pos) return;
      if(!confirm("Möchtest du die aktuelle Klasse wirklich ändern?")) return;
      pos=i;
      initialized=true;
      await speichereSteuerung();
      await schreibeAnzeige();
      aktualisiereKarten();
      aktualisiereStartNextLabel();
      zeigeInfo();
      aktualisiereKlassenListe();
      keepActiveAndNextInView();
    };

    klassenList.appendChild(div);
  });
}

function keepActiveAndNextInView(){
  if(!initialized) return;
  const cont=klassenList;
  if(!cont) return;
  const active=cont.querySelector(".listItem.active");
  const next=cont.querySelector(".listItem.next");
  if(!active && !next) return;

  const crect=cont.getBoundingClientRect();
  let top=Infinity,bottom=-Infinity;

  [active,next].forEach(el=>{
    if(!el) return;
    const r=el.getBoundingClientRect();
    const relTop=(r.top-crect.top)+cont.scrollTop;
    const relBottom=(r.bottom-crect.top)+cont.scrollTop;
    if(relTop<top) top=relTop;
    if(relBottom>bottom) bottom=relBottom;
  });

  if(top===Infinity) return;

  const pad=12;
  const viewTop=cont.scrollTop;
  const viewBot=viewTop+cont.clientHeight;

  if(top-pad<viewTop){
    cont.scrollTo({top:Math.max(top-pad,0),behavior:"smooth"});
  }
  else if(bottom+pad>viewBot){
    cont.scrollTo({top:bottom+pad-cont.clientHeight,behavior:"smooth"});
  }
}

/* == Bedienung == */
startNextBtn.onclick = async()=>{
  if(klassen.length===0){ alert("Bitte zuerst die Klassenliste eingeben."); return; }
  if(!initialized) initialized=true;
  else if(pos<klassen.length-1) pos++;
  await speichereSteuerung();
  await schreibeAnzeige();
  aktualisiereKarten();
  aktualisiereStartNextLabel();
  zeigeInfo();
  aktualisiereKlassenListe();
  requestAnimationFrame(keepActiveAndNextInView);
};

prevBtn.onclick = async()=>{
  if(!initialized||klassen.length===0) return;
  if(pos>0) pos--;
  await speichereSteuerung();
  await schreibeAnzeige();
  aktualisiereKarten();
  aktualisiereStartNextLabel();
  zeigeInfo();
  aktualisiereKlassenListe();
  requestAnimationFrame(keepActiveAndNextInView);
};

resetBtn.onclick = async()=>{
  if(!confirm("Soll die Notenkonferenz wirklich neu gestartet werden?")) return;
  initialized=false;
  pos=0;
  await speichereSteuerung();
  const now=Date.now();
  await update(ref(db,"anzeige"),{
    aktuell:null,
    vorbereitung:null,
    aktuellRaum:null,
    vorbereitungRaum:null,
    aktualisiertAm:now,
    updatedAt:now
  });
  aktualisiereKarten();
  aktualisiereStartNextLabel();
  zeigeInfo();
  aktualisiereKlassenListe();
};

/* == Modal öffnen/schließen == */
function openListEditor(){
  editorTextarea.value = klassen.join("\n");
  raum1Input.value = raum1;
  raum2Input.value = raum2;
  listModal.classList.add("open");
  listModal.setAttribute("aria-hidden","false");
  document.body.classList.add("modal-open");
}
function closeListEditor(){
  listModal.classList.remove("open");
  listModal.setAttribute("aria-hidden","true");
  document.body.classList.remove("modal-open");
}

editBtn.onclick=openListEditor;
cancelEditBtn.onclick=closeListEditor;

listModal.addEventListener("click",e=>{
  if(e.target===listModal) closeListEditor();
});
window.addEventListener("keydown",e=>{
  if(e.key==="Escape" && listModal.classList.contains("open")) closeListEditor();
});

/* == Reihenfolge umdrehen == */
document.getElementById("reverseBtn").onclick = ()=>{
  const lines=editorTextarea.value.split("\n").map(s=>s.trim()).filter(Boolean);
  if(!lines.length){ alert("Keine Klassen vorhanden."); return; }
  if(!confirm("Reihenfolge wirklich umdrehen?")) return;
  editorTextarea.value = lines.reverse().join("\n");
};

/* == Speichern == */
saveEditBtn.onclick = async()=>{
  const lines=editorTextarea.value.split("\n").map(s=>s.trim()).filter(Boolean);
  klassen=lines;

  raum1=raum1Input.value.trim()||"8AT";
  raum2=raum2Input.value.trim()||"8S";

  if(klassen.length===0){ pos=0; initialized=false; }
  else if(pos>=klassen.length){ pos=klassen.length-1; }

  await speichereSteuerung();
  if(initialized) await schreibeAnzeige();

  aktualisiereKarten();
  aktualisiereStartNextLabel();
  zeigeInfo();
  aktualisiereKlassenListe();

  saveHint.textContent="Gespeichert ✔";
  setTimeout(()=>saveHint.textContent="",1500);

  closeListEditor();
};

/* == ENTER triggert Next == */
window.addEventListener("keydown",e=>{
  if(e.key!=="Enter"||e.shiftKey||e.ctrlKey||e.altKey) return;
  if(getComputedStyle(loginBox).display!=="none") return;
  startNextBtn.click();
});

</script>
</body>
</html>
