
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notenkonferenz – Admin</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    body { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; margin:0; padding:20px; background:#0b1020; color:#eaf2ff; }
    .box { background:#151a31; padding:20px; border-radius:12px; max-width:720px; margin:auto; }
    textarea { width:100%; height:220px; border-radius:8px; padding:10px; background:#0f1428; color:#eaf2ff; border:1px solid #2a335f; }
    input { width:100%; padding:10px; margin-top:10px; border-radius:8px; background:#0f1428; color:#eaf2ff; border:1px solid #2a335f; }
    button { padding:10px 16px; margin-top:10px; border:0; border-radius:8px; cursor:pointer; font-size:16px; }
    .btn1 { background:#3b82f6; color:white; }
    .btn2 { background:#22c55e; color:white; margin-left:8px; }
    .label { font-weight:600; margin-top:12px; display:block; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .muted { opacity:.75; font-size:13px; }
    .error { color:#ffb4b4; margin-top:8px; }
  </style>
</head>
<body>

<div class="box">
  <h2>Admin – Notenkonferenz</h2>

  <!-- Login -->
  <div id="loginBox">
    <label class="label">E‑Mail</label>
    <input id="email" type="email" autocomplete="username" />

    <label class="label">Passwort</label>
    <input id="passwort" type="password" autocomplete="current-password" />

    <div class="row">
      <button id="loginBtn" class="btn1">Anmelden</button>
    </div>
    <div id="loginError" class="error"></div>
    <div class="muted" style="margin-top:6px;">Domain muss in Firebase unter <i>Authentifizierung → Einstellungen → Autorisierte Domains</i> freigegeben sein (z. B. <code>chrisiweb.github.io</code>).</div>
  </div>

  <!-- Panel -->
  <div id="panel" style="display:none;">
    <label class="label">Liste aller Klassen (eine pro Zeile)</label>
    <textarea id="klassenInput" placeholder="z. B.&#10;1A&#10;1B&#10;1C&#10;2A&#10;…"></textarea>

    <div class="row">
      <button id="startBtn" class="btn1" title="Erste Klasse → Aktuell, zweite → In Vorbereitung">Start</button>
      <button id="nextBtn" class="btn2" title="Verschiebt: Vorbereitung → Aktuell; nächste aus Liste → Vorbereitung">Nächste Klasse</button>
    </div>

    <div id="info" class="muted" style="margin-top:10px;"></div>
  </div>
</div>

<script type="module">
  // --- Firebase Config (von dir) ---
  const firebaseConfig = {
    apiKey: "AIzaSyCuLVnVCnpc1JPO5eRsUpwOdTjacZ6cgso",
    authDomain: "gvp-notenkonferenz.firebaseapp.com",
    databaseURL: "https://gvp-notenkonferenz-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "gvp-notenkonferenz",
    storageBucket: "gvp-notenkonferenz.appspot.com", // korrigiert
    messagingSenderId: "443453428623",
    appId: "1:443453428623:web:3d3640bfe6ed2c38e871fa",
    measurementId: "G-SVZX9DEJNP"
  };

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getDatabase, ref, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getDatabase(app);

  const loginBox = document.getElementById("loginBox");
  const panel    = document.getElementById("panel");
  const info     = document.getElementById("info");
  const loginBtn = document.getElementById("loginBtn");

  let klassen = [];
  let position = 0;

  loginBtn.onclick = async () => {
    const email = (document.getElementById("email").value || "").trim();
    const pass  = (document.getElementById("passwort").value || "").trim();
    document.getElementById("loginError").textContent = "";
    try {
      await signInWithEmailAndPassword(auth, email, pass);
    } catch (err) {
      document.getElementById("loginError").textContent = err?.message ?? String(err);
    }
  };

  onAuthStateChanged(auth, (user) => {
    const signedIn = !!user;
    loginBox.style.display = signedIn ? "none" : "";
    panel.style.display    = signedIn ? "" : "none";
  });

  // Start: setzt erste zwei Zeilen
  document.getElementById("startBtn").onclick = () => {
    klassen = document.getElementById("klassenInput").value
      .split("\n")
      .map(x => x.trim())
      .filter(x => x.length > 0);

    position = 0;
    updateAnzeige();
  };

  // Nächste: schiebt eine weiter
  document.getElementById("nextBtn").onclick = () => {
    if (position < klassen.length - 1) {
      position++;
      updateAnzeige();
    } else {
      // Ende der Liste – Vorbereitung wird leer
      position = klassen.length - 1;
      updateAnzeige();
    }
  };

  function updateAnzeige() {
    const aktuell = klassen[position] || "";
    const vorb    = klassen[position + 1] || "";

    update(ref(db, "anzeige"), {
      aktuell: aktuell,
      vorbereitung: vorb,
      aktualisiertAm: Date.now()
    });

    info.innerHTML = `
      <div>Aktuell: <b>${aktuell || "—"}</b></div>
      <div>In Vorbereitung: <b>${vorb || "—"}</b></div>
      <div>Position: ${Math.min(position + 1, klassen.length)} / ${klassen.length}</div>
    `;
  }
</script>

</body>
</html>
