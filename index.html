<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GvP Notenkonferenz â€“ Liveticker</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg: #0b1020;
      --fg: #eaf2ff;
      --color-aktuell: #0ea5e9; /* hellblau */
      --color-vorb:    #22c55e; /* grÃ¼n   */
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap {
      display: grid;
      grid-template-rows: 1fr 1fr;
      gap: 28px;
      padding: clamp(12px, 3vw, 40px);
      height: 100%;
      box-sizing: border-box;
    }
    .card {
      border-radius: 24px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    /* 1) Fallback, der auf allen (auch Smartboard-)Browsern sicher lÃ¤uft */
    .aktuell {
      background: linear-gradient(135deg, rgba(14,165,233,0.25), rgba(255,255,255,0.04));
      border: 2px solid rgba(14,165,233,0.60);
    }
    
    .vorb {
      background: linear-gradient(135deg, rgba(34,197,94,0.25), rgba(255,255,255,0.04));
      border: 2px solid rgba(34,197,94,0.60);
    }
    
    /* 2) Wenn der Browser color-mix() versteht, nimm die ursprÃ¼ngliche, â€žmoderneâ€œ Variante */
    @supports (color: color-mix(in lab, black, white)) {
      .aktuell {
        background: linear-gradient(
          135deg,
          color-mix(in lab, var(--color-aktuell) 25%, transparent),
          rgba(255,255,255,.04)
        );
        border: 2px solid color-mix(in lab, var(--color-aktuell) 60%, transparent);
      }
    
      .vorb {
        background: linear-gradient(
          135deg,
          color-mix(in lab, var(--color-vorb) 25%, transparent),
          rgba(255,255,255,.04)
        );
        border: 2px solid color-mix(in lab, var(--color-vorb) 60%, transparent);
      }
    }
    .label {
      opacity: .85;
      font-weight: 600;
      letter-spacing: .08em;
      text-transform: uppercase;
      font-size: clamp(14px, 2.2vw, 20px);
    }
    /* groÃŸe Klassenanzeige */
    .value {
      margin-top: .25em;
      font-weight: 900;
      line-height: 1.0;
      font-size: clamp(48px, 12vw, 180px);
      word-wrap: break-word;
      letter-spacing: 0.01em;
    }
    /* NEU: Raumzeile (grÃ¶ÃŸer) */
    .room {
      margin-top: .35em;
      font-size: clamp(14px, 3vw, 24px);
      opacity: .85;
      font-weight: 600;
    }

    /* Zeitstempel unten rechts */
    .footer {
      position: fixed;
      bottom: 10px;
      right: 16px;
      opacity: .5;
      font-size: 12px;
    }
    /* Ton-Schalter: fixiert oben rechts */
    .sound-toggle {
      position: fixed;
      top: 12px;
      right: 12px;
      z-index: 10;
    }
    .btn {
      appearance: none;
      border: 1px solid rgba(234,242,255,.25);
      background: rgba(255,255,255,.08);
      color: var(--fg);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 16px; /* Emoji lesbar */
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
    }
    .btn[aria-pressed="true"] {
      background: rgba(34,197,94,.20);
      border-color: rgba(34,197,94,.55);
    }
    @media (orientation: portrait) {
      .wrap { grid-template-rows: auto auto; }
      .value { font-size: clamp(42px, 14vw, 160px); }
    }
  </style>
</head>
<body>
  <!-- Ton-Schalter oben rechts -->
  <div class="sound-toggle">
    <button id="soundToggle" class="btn" aria-pressed="false" title="Ton bei Ã„nderungen aktivieren/deaktivieren">
      <span id="bellIcon" aria-hidden="true">ðŸ”•</span>
      <span id="bellText">Ton aus</span>
    </button>
  </div>

  <div class="wrap">
    <section class="card aktuell">
      <div class="label">Laufende Klassenkonferenz</div>
      <div id="aktuell" class="value">â€“</div>
      <!-- NEU: Raumzeile -->
      <div id="aktuellRoom" class="room"></div>
    </section>

    <section class="card vorb">
      <div class="label">In Vorbereitung</div>
      <div id="vorb" class="value">â€“</div>
      <!-- NEU: Raumzeile -->
      <div id="vorbRoom" class="room"></div>
    </section>
  </div>

  <div class="footer" id="ts"></div>

  <!-- MP3 direkt neben index.html ablegen -->
  <audio id="chime" src="chime.mp3" preload="auto"></audio>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCuLVnVCnpc1JPO5eRsUpwOdTjacZ6cgso",
      authDomain: "gvp-notenkonferenz.firebaseapp.com",
      databaseURL: "https://gvp-notenkonferenz-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gvp-notenkonferenz",
      storageBucket: "gvp-notenkonferenz.firebasestorage.app",
      messagingSenderId: "443453428623",
      appId: "1:443453428623:web:3d3640bfe6ed2c38e871fa",
      measurementId: "G-SVZX9DEJNP"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    const aktuellEl     = document.getElementById('aktuell');
    const vorbEl        = document.getElementById('vorb');
    const aktuellRoomEl = document.getElementById('aktuellRoom');
    const vorbRoomEl    = document.getElementById('vorbRoom');
    const tsEl          = document.getElementById('ts');

    const soundToggleBtn = document.getElementById('soundToggle');
    const bellIcon = document.getElementById('bellIcon');
    const bellText = document.getElementById('bellText');

    // Audio-Element
    const audioEl = document.getElementById('chime');
    audioEl.volume = 1.0;
    let soundEnabled = false; // standardmÃ¤ÃŸig aus

    function updateBellUI() {
      soundToggleBtn.setAttribute('aria-pressed', soundEnabled ? 'true' : 'false');
      bellIcon.textContent = soundEnabled ? '\u{1F514}' : '\u{1F515}';
      bellText.textContent = soundEnabled ? 'Ton an' : 'Ton aus';
    }

    soundToggleBtn.addEventListener('click', async () => {
      // Nutzeraktion: erlaubt Audio-Wiedergabe im Browser
      try { await audioEl.play(); audioEl.pause(); audioEl.currentTime = 0; } catch {}
      soundEnabled = !soundEnabled;
      updateBellUI();
      // kurzes akustisches Feedback nur bei Aktivierung
      if (soundEnabled) {
        try { audioEl.currentTime = 0; await audioEl.play(); }
        catch(e) { console.warn('Konnte Testton nicht abspielen:', e); }
      }
    });

    async function playChime() {
      if (!soundEnabled) return;
      try {
        audioEl.currentTime = 0;
        await audioEl.play();
      } catch (e) {
        console.warn('Ton konnte nicht abgespielt werden:', e);
      }
    }

    // ===== Anzeige robust aus DB lesen =====
    const textOrDash = (x) => {
      const s = (x ?? '').toString().trim();
      return s.length ? s : 'â€“';
    };
    const roomOrEmpty = (x) => {
      const s = (x ?? '').toString().trim();
      return s.length ? `(Raum: ${s})` : '';
    };

    let prev = { aktuell: null, vorbereitung: null };

    onValue(ref(db, 'anzeige'), (snap) => {
      const v = snap.val() ?? {};

      // Inhalte (robust gegen "", null, undefined)
      const neuAktuell = textOrDash(v.aktuell);
      const neuVorb    = textOrDash(v.vorbereitung);

      const changed =
        (prev.aktuell !== null && prev.aktuell !== neuAktuell) ||
        (prev.vorbereitung !== null && prev.vorbereitung !== neuVorb);

      aktuellEl.textContent = neuAktuell;
      vorbEl.textContent    = neuVorb;

      // RÃ¤ume
      aktuellRoomEl.textContent = roomOrEmpty(v.aktuellRaum);
      vorbRoomEl.textContent    = roomOrEmpty(v.vorbereitungRaum);

      // Farben (optional von Admin setzbar)
      document.documentElement.style.setProperty('--color-aktuell', v.colorAktuell ?? '#0ea5e9');
      document.documentElement.style.setProperty('--color-vorb',    v.colorVorb    ?? '#22c55e');

      // Zeitstempel
      const dt = v.updatedAt ? new Date(v.updatedAt) : null;
      tsEl.textContent = dt ? `Stand: ${dt.toLocaleString('de-AT')}` : '';

      if (changed) playChime();
      prev = { aktuell: neuAktuell, vorbereitung: neuVorb };
    });

    // initiale UI
    updateBellUI();
  </script>
</body>
</html>
``

